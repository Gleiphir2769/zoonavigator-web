<!--
  ~ Copyright (C) 2017  Ľuboš Kozmon
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<!--suppress HtmlUnknownTag, HtmlUnknownAttribute, HtmlFormInputWithoutLabel -->
<form [formGroup]="aclForm"
      layout="column"
      layout-fill>
  <div flex>
    <mat-card>
      <mat-card-content>
        <input type="hidden"
               formControlName="aclVersion"/>
        <div formArrayName="aclArray">
          <table *ngIf="aclFormArray.length > 0">
            <colgroup>4</colgroup>
            <thead>
            <tr>
              <th rowspan="2" style="text-align: left">Scheme</th>
              <th rowspan="2" style="text-align: left">Id</th>
              <th colspan="5">Permissions</th>
              <th></th>
            </tr>
            <tr>
              <th mdTooltip="Create" mdTooltipPosition="below">C</th>
              <th mdTooltip="Read" mdTooltipPosition="below">R</th>
              <th mdTooltip="Delete" mdTooltipPosition="below">D</th>
              <th mdTooltip="Write" mdTooltipPosition="below">W</th>
              <th mdTooltip="Admin" mdTooltipPosition="below">A</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let acl of aclFormArray.controls; let i = index" [formGroup]="acl">
              <td>
                <mat-input-container>
                  <input matInput
                         type="text"
                         formControlName="scheme"/>
                </mat-input-container>
                <div *ngIf="!acl.get('scheme').valid" class="zoo-warn">
                  <small>Scheme is required.</small>
                </div>
              </td>
              <td>
                <mat-input-container>
                  <input matInput
                         type="text"
                         formControlName="id"/>
                </mat-input-container>
              </td>
              <td>
                <mat-checkbox [formControl]="acl.get('permissions').get('canCreate')"
                             mdTooltip="Create"
                             mdTooltipPosition="below"
                             class="zoo-nolabel"
                             color="primary">
                </mat-checkbox>
              </td>
              <td>
                <mat-checkbox [formControl]="acl.get('permissions').get('canRead')"
                             mdTooltip="Read"
                             mdTooltipPosition="below"
                             class="zoo-nolabel"
                             color="primary">
                </mat-checkbox>
              </td>
              <td>
                <mat-checkbox [formControl]="acl.get('permissions').get('canDelete')"
                             mdTooltip="Delete"
                             mdTooltipPosition="below"
                             class="zoo-nolabel"
                             color="primary">
                </mat-checkbox>
              </td>
              <td>
                <mat-checkbox [formControl]="acl.get('permissions').get('canWrite')"
                             mdTooltip="Write"
                             mdTooltipPosition="below"
                             class="zoo-nolabel"
                             color="primary">
                </mat-checkbox>
              </td>
              <td>
                <mat-checkbox [formControl]="acl.get('permissions').get('canAdmin')"
                             mdTooltip="Admin"
                             mdTooltipPosition="below"
                             class="zoo-nolabel"
                             color="primary">
                </mat-checkbox>
              </td>
              <td>
                <button mat-button
                        class="tc-red-800"
                        type="button"
                        (click)="removeAclFormGroup(i)">
                  Remove
                </button>
              </td>
            </tr>
            </tbody>
          </table>
        </div>

        <div layout="row" class="zoo-form-controls">
          <button mat-button
                  type="button"
                  (click)="addAclFormGroup()">
            Add new
          </button>
          <button mat-button
                  type="button"
                  *ngIf="aclFormArray.length > 0"
                  (click)="clearAclFormArray()">
            Remove all
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="zoo-actionbar">
    <button mat-button
            type="button"
            (click)="onRefresh()">
      Refresh
    </button>
    <button mat-raised-button
            color="accent"
            [disabled]="!aclForm.valid || !aclForm.dirty || aclFormArray.controls.length === 0"
            (click)="onSubmit()">
      Save
    </button>
    <mat-checkbox formControlName="applyRecursive"
                 color="accent">
      <small>Apply recursively</small>
    </mat-checkbox>
  </div>
</form>
